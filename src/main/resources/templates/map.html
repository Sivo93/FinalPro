<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Map Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=213920e00aedac3eb98f084bc572122b&autoload=false"></script>
    <link rel="stylesheet" href="/css/header.css">
    <link href="https://fonts.googleapis.com/css?family=Work+Sans:300,400,500,600,700" rel="stylesheet">
    <link rel="stylesheet" href="/css/open-iconic-bootstrap.min.css">
    <link rel="stylesheet" href="/css/animate.css">
    <link rel="stylesheet" href="/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/css/owl.theme.default.min.css">
    <link rel="stylesheet" href="/css/magnific-popup.css">
    <link rel="stylesheet" href="/css/aos.css">
    <link rel="stylesheet" href="/css/ionicons.min.css">
    <link rel="stylesheet" href="/css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="/css/jquery.timepicker.css">
    <link rel="stylesheet" href="/css/flaticon.css">
    <link rel="stylesheet" href="/css/icomoon.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- 공통 헤더 포함 -->
    <div th:replace="~{common/header :: fragment}"></div>

    <div class="hero-wrap hero-wrap-2" style="background-image: url('images/test.png');" data-stellar-background-ratio="0.5">
        <div class="overlay"></div>
        <div class="container">
            <div class="row no-gutters slider-text align-items-end justify-content-start">
                <div class="col-md-8 ftco-animate text-center text-md-left mb-5">
                    <p class="breadcrumbs"><span class="mr-2"><a href="index.html">홈</a></span> <span class="mr-2"><a href="blog.html">이불밖은위험해</a></span></p>
                    <h1 class="mb-3 bread">이불밖은 위험해</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="col-md sidebar ftco-animate">
            <div id="map" style="width:100%;height:400px;"></div>
            <div id="store-list" style="margin-top: 20px;">
                <h3>상가 리스트</h3>
                <ul id="store-list-items">
                    <!-- 상가 리스트가 여기에 동적으로 추가됩니다. -->
                </ul>
            </div>

            <script th:inline="javascript">
                // Kakao Maps API 로드 완료 후 실행
                kakao.maps.load(function() {
                    var stores = JSON.parse(/*[[${storesJson}]]*/ '[]');
                    console.log("Stores data in JavaScript:", stores);

                    // 지도 초기화
                    var mapContainer = document.getElementById('map'); 
                    var mapOption = { 
                        center: new kakao.maps.LatLng(37.5665, 126.978), 
                        level: 3 
                    };
                    var map = new kakao.maps.Map(mapContainer, mapOption);

                    // 상가 데이터로 마커 추가
                    stores.forEach(function(store) {
                        var markerPosition = new kakao.maps.LatLng(store.latitude, store.longitude); 
                        var marker = new kakao.maps.Marker({
                            position: markerPosition
                        });
                        marker.setMap(map);
                    });

                    // 현재 위치를 가져와서 지도에 마커를 표시합니다.
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(function(position) {
                            var currentLat = position.coords.latitude;
                            var currentLng = position.coords.longitude;
                            var currentPosition = new kakao.maps.LatLng(currentLat, currentLng);

                            // 커스텀 이미지 URL
                            var imageSrc = 'http://example.com/path/to/your/custom-marker-image.png'; // 변경하세요
                            var imageSize = new kakao.maps.Size(64, 69); // 이미지 크기 (픽셀 단위)
                            var imageOption = {offset: new kakao.maps.Point(27, 69)}; // 이미지에서 클릭 위치 (픽셀 단위)

                            // 커스텀 마커 이미지 생성
                            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);

                            // 현재 위치 마커 추가
                            var currentMarker = new kakao.maps.Marker({
                                position: currentPosition,
                                map: map,
                                image: markerImage, // 커스텀 이미지 적용
                                title: "현재 위치"
                            });

                            // 현재 위치 중심으로 지도 이동
                            map.setCenter(currentPosition);
                            
                            // 현재 위치 정보 출력
                            console.log("Current Location:", currentLat, currentLng);
                            
                        }, function(error) {
                            console.error("Error getting location:", error);
                        });
                    } else {
                        console.error("Geolocation is not supported by this browser.");
                    }
                });
            </script>
        </div>
    </div>

    <!-- 공통 푸터 포함 -->
    <div th:replace="~{common/footer :: footer}"></div>
</body>
</html>
