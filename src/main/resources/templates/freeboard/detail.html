<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8" xmlns:th="http://www.thymeleaf.org">
	<title>Insert title here</title>
	<!-- jquery cdn -->
	<script src="https://code.jquery.com/jquery-3.6.3.min.js"
		integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
</head>

<body>
	<table>
		<tr>
			<th>번호</th>
			<td th:text="${freeBoard.seq}"></td>
		</tr>
		<tr>
			<th>태그</th>
			<td th:text="${freeBoard.tag}"></td>
		</tr>
		<tr>
			<th>제목</th>
			<td th:text="${freeBoard.title}"></td>
		</tr>
		<tr>
			<th>작성자</th>
			<td th:text="${freeBoard.nickname}"></td>
		</tr>
		<tr>
			<th>작성일</th>
			<td th:text="${freeBoard.createdTime}"></td>
		</tr>
		<tr>
			<th>조회수</th>
			<td th:text="${freeBoard.views}"></td>
		</tr>
		<tr>
			<th>추천</th>
			<td th:text="${freeBoard.likeCount}"></td>
		</tr>
		<tr>
			<th>내용</th>
			<td th:text="${freeBoard.contents}"></td>
		</tr>
		<tr th:if="${freeBoard.fileAttached == 1}">
			<th>이미지</th>
			<td th:each="fileName: ${freeBoard.storedFileName}">
				<img th:src="@{|/upload/${fileName}|}" alt="" >
			</td>
		</tr>

	</table>
	<button onclick="listReq()">목록</button>
	<button onclick="updateReq()">수정</button>
	<button onclick="deleteReq()">삭제</button>
	
	<!-- 댓글 작성 부분 -->
	<div id="comment-write">
		<input type="hidden" id="commentLoginid" th:value="${session.loginid}">
		<input type="text" id="commentWriter" th:value="${session.nickname}" readonly>
		<input type="text" id="commentContents" placeholder="내용" >
		<button id="comment-write-btn" onclick="commentWrite()">댓글작성</button>
	</div>
	
	<!-- 댓글 출력 부분 -->
	<div id="comment-list">
		<table>
			<tr>
				<th>댓글번호</th>
				<th>작성자</th>
				<th>내용</th>
				<th>작성시간</th>
			</tr>
			<tr th:each="comment: ${freeBoardCommentList}">
				<td th:text="${comment.seq}"></td>
				<td th:text="${comment.nickname}"></td>
				<td th:text="${comment.commentContents}"></td>
				<!--<td th:text="${comment.commentCreatedTime}"></td>-->
				<td th:text="${comment.formattedCommentCreatedTime}"></td>
			</tr>
		</table>
		
	</div>		
	
</body>
<script th:inline="javascript">
	const commentWrite = () => {
		const writer = document.getElementById("commentWriter").value; // 작성자
		const contents = document.getElementById("commentContents").value; // 작성내용
		const seq = `[[${freeBoard.seq}]]`; // 게시글번호
		const writerId = document.getElementById("commentLoginid").value; // 작성자의 loginid
		console.log("작성자: ", writer);
		console.log("내용: ", contents);		
		$.ajax({
			// 요청방식: post, 요청주소: /comment/save, 요청데이터: 작성자, 작성내용, 게시글번호
			type: "post",
			url: "/comment/save",
			data: {
				"commentWriter": writer,
				"commentContents": contents,
				"freeBoardSeq": seq,
				"commentLoginid": writerId
			},
			success: function (res) {
               console.log("요청성공", res);
               let output = "<table>";
               output += "<tr><th>댓글번호</th>";
               output += "<th>작성자</th>";
               output += "<th>내용</th>";
               output += "<th>작성시간</th></tr>";
               for (let i in res) {
                   output += "<tr>";
                   output += "<td>" + res[i].seq + "</td>";
                   output += "<td>" + res[i].commentWriter + "</td>";
                   output += "<td>" + res[i].commentContents + "</td>";
                   output += "<td>" + res[i].commentCreatedTime + "</td>";
                   output += "</tr>";
               }
               output += "</table>";
               document.getElementById('comment-list').innerHTML = output;
               //document.getElementById('commentWriter').value = '';
               document.getElementById('commentContents').value = '';
           },
			error: function(err) {
				console.log("요청 실패", err);
			}
		});
	}
	
	
	const listReq = () => {
		console.log("목록 요청");
		const page = `[[${page}]]`;
		location.href = "/freeboard/paging?page=" + page;
	}
	const updateReq = () => {
		console.log("수정 요청");
		const seq = `[[${freeBoard.seq}]]`;
		console.log(seq);
		location.href = "/freeboard/update/" + seq;
	}
	const deleteReq = () => {
		console.log("삭제 요청");
		const seq = `[[${freeBoard.seq}]]`;
		location.href = "/freeboard/delete/" + seq;
	}
</script>

</html>