<!DOCTYPE html>
<html lang="en">

<head>
	<title>자유게시판</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" th:href="@{/css/header.css}">
	<link href="https://fonts.googleapis.com/css?family=Work+Sans:300,400,500,600,700" rel="stylesheet">
	<link rel="stylesheet" th:href="@{/css/open-iconic-bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/css/animate.css}">
	<link rel="stylesheet" th:href="@{/css/owl.carousel.min.css}">
	<link rel="stylesheet" th:href="@{/css/owl.theme.default.min.css}">
	<link rel="stylesheet" th:href="@{/css/magnific-popup.css}">
	<link rel="stylesheet" th:href="@{/css/aos.css}">
	<link rel="stylesheet" th:href="@{/css/ionicons.min.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap-datepicker.css}">
	<link rel="stylesheet" th:href="@{/css/jquery.timepicker.css}">
	<link rel="stylesheet" th:href="@{/css/flaticon.css}">
	<link rel="stylesheet" th:href="@{/css/icomoon.css}">
	<link rel="stylesheet" th:href="@{/css/style.css}">
	<style>
		.toggle-menu {
			display: none;
			position: absolute;
			background: #fff;
			border: 1px solid #ccc;
			z-index: 1000;
		}

		.toggle-menu ul {
			list-style: none;
			padding: 0;
			margin: 0;
		}

		.toggle-menu ul li {
			padding: 10px;
			cursor: pointer;
		}

		.toggle-menu ul li:hover {
			background: #f1f1f1;
		}
	</style>
</head>

<body>
	<div th:replace="~{common/header :: fragment}"></div>
	<div class="hero-wrap hero-wrap-2" style="background-image: url('images/test.png');"
		data-stellar-background-ratio="0.5">
		<div class="overlay"></div>
		<div class="container">
			<div class="row no-gutters slider-text align-items-end justify-content-start">
				<div class="col-md-8 ftco-animate text-center text-md-left mb-5">
					<p class="breadcrumbs"><span class="mr-2"><a href="index.html">홈</a></span> <span class="mr-2"><a
								href="sokdakfree.html">속닥속닥</a></span> <span>자유게시판</span></p>
					<h1 class="mb-3 bread">속닥속닥</h1>
				</div>
			</div>
		</div>
	</div>
	<section class="ftco-section">
		<div class="board-main">
			<div class="row">
				<div class="col-md-8 ftco-animate">
					<h2 class="mb-3">
						<table class="board">
							<span class="text">
								<thead>
									<ul>
										<li><a href="sokdakfree.html">자유게시판</a></li>
										<li><a href="sokdakbitic.html">자랑게시판</a></li>
										<li><a href="sokdaknotice.html">공지사항</a></li>
									</ul>
									<!-- 태그 필터링 UI -->
									<form id="tagFilterForm" action="/freeboard/paging" method="get">
										<select name="tag" onchange="document.getElementById('tagFilterForm').submit()">
											태그별 보기:
											<option value="" ${currentTag==null ? 'selected' : '' }>전체</option>
											<option value="운동" ${currentTag=='운동' ? 'selected' : '' }>운동</option>
											<option value="여가" ${currentTag=='여가' ? 'selected' : '' }>여가</option>
											<option value="여행" ${currentTag=='여행' ? 'selected' : '' }>여행</option>
											<option value="동물" ${currentTag=='동물' ? 'selected' : '' }>동물</option>
											<option value="질문" ${currentTag=='질문' ? 'selected' : '' }>질문</option>
											<option value="꿀팁" ${currentTag=='꿀팁' ? 'selected' : '' }>꿀팁</option>
										</select>
									</form>

									<tr>
										<th>번호</th>
										<th>태그</th>
										<th>제목</th>
										<th>작성자</th>
										<th>작성일</th>
										<th>조회수</th>
										<th>추천</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="freeboard: ${freeBoardList}">
										<td th:text="${freeboard.seq}"></td>
										<td th:text="${freeboard.tag}"></td>
										<td><a th:href="@{|/freeboard/${freeboard.seq}|(page=${freeBoardList.number + 1})}"
												th:text="${freeboard.title}"></a></td>
										<td>
											<span class="user-name" th:data-nickname="${freeboard.nickname}"
												th:text="${freeboard.nickname}" style="cursor: pointer;"></span>
											<div class="toggle-menu">
												<ul>
													<li class="start-chat" th:data-nickname="${freeboard.nickname}">1대1
														채팅</li>
												</ul>
											</div>
										</td>
										<td th:text="*{#temporals.format(freeboard.createdTime, 'yyyy-MM-dd HH:mm')}">
										</td>
										<td th:text="${freeboard.views}"></td>
										<td th:text="${freeboard.likeCount}"></td>
									</tr>
								</tbody>
							</span>
						</table>
						<table>
							<a th:href="@{/freeboard/paging(page=1)}">First</a>
							<a
								th:href="${freeBoardList.first} ? '#' : @{/freeboard/paging(page=${freeBoardList.number})}">prev</a>
							<span th:each="page: ${#numbers.sequence(startPage, endPage)}">
								<span th:if="${page == freeBoardList.number + 1}" th:text="${page}"></span>
								<span th:unless="${page == freeBoardList.number + 1}">
									<a th:href="@{/freeboard/paging(page=${page})}" th:text="${page}"></a>
								</span>
							</span>
							<a
								th:href="${freeBoardList.last} ? '#' : @{/freeboard/paging(page=${freeBoardList.number + 2})}">next</a>
							<a th:href="@{/freeboard/paging(page=${freeBoardList.totalPages})}">Last</a>
							<br />
							<a href="/freeboard/save">글작성 </a>
						</table>
				</div>
				<div class="col-md-4 sidebar ftco-animate">
					<div class="sidebar-box">
						<form action="#" class="search-form">
							<div class="form-group">
								<div class="icon">
									<span class="icon-search"></span>
								</div>
								<input type="text" class="form-control" placeholder="Type a keyword and hit enter">
							</div>
						</form>
					</div>
					<div class="sidebar-box ftco-animate">
						<div class="categories">
							<h3>속닥속닥</h3>
							<li><a href="sokdakfree.html">자유게시판 <span></span></a></li>
							<li><a href="sokdakbitic.html">자랑게시판 <span></span></a></li>
							<li><a href="sokdaknotice.html">공지사항 <span></span></a></li>
						</div>
					</div>
					<div class="sidebar-box ftco-animate">
						<h3>인기글</h3>
						<div class="block-21 mb-4 d-flex">
							<a class="blog-img mr-4" style="background-image: url(#);"></a>
							<div class="text">
								<h3 class="heading"><a href="#">Even the all-powerful Pointing has no control about the
										blind texts</a></h3>
								<div class="meta">
									<div><a href="#"><span class="icon-calendar"></span> May 08, 2019</a></div>
									<div><a href="#"><span class="icon-person"></span> Admin</a></div>
									<div><a href="#"><span class="icon-chat"></span> 19</a></div>
								</div>
							</div>
						</div>
						<div class="block-21 mb-4 d-flex">
							<a class="blog-img mr-4" style="background-image: url(images/image_2.jpg);"></a>
							<div class="text">
								<h3 class="heading"><a href="#">Even the all-powerful Pointing has no control about the
										blind texts</a></h3>
								<div class="meta">
									<div><a href="#"><span class="icon-calendar"></span> May 08, 2019</a></div>
									<div><a href="#"><span class="icon-person"></span> Admin</a></div>
									<div><a href="#"><span class="icon-chat"></span> 19</a></div>
								</div>
							</div>
						</div>
						<div class="block-21 mb-4 d-flex">
							<a class="blog-img mr-4" style="background-image: url(images/image_3.jpg);"></a>
							<div class="text">
								<h3 class="heading"><a href="#">Even the all-powerful Pointing has no control about the
										blind texts</a></h3>
								<div class="meta">
									<div><a href="#"><span class="icon-calendar"></span> May 08, 2019</a></div>
									<div><a href="#"><span class="icon-person"></span> Admin</a></div>
									<div><a href="#"><span class="icon-chat"></span> 19</a></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
	</section>
	<div th:replace="~{common/footer :: footer}"></div>
	<script src="js/jquery.min.js"></script>
	<script src="js/jquery-migrate-3.0.1.min.js"></script>
	<script src="js/popper.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.easing.1.3.js"></script>
	<script src="js/jquery.waypoints.min.js"></script>
	<script src="js/jquery.stellar.min.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/aos.js"></script>
	<script src="js/jquery.animateNumber.min.js"></script>
	<script src="js/bootstrap-datepicker.js"></script>
	<script src="js/jquery.timepicker.min.js"></script>
	<script src="js/scrollax.min.js"></script>
	<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
	<script src="js/google-map.js"></script>
	<script src="js/main.js"></script>
	<script src="/js/header.js"></script>
	<script src="/js/main.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</body>
<script>
	const saveReq = () => {
		location.href = "/freeboard/save";
	}

	function openChatWithUser(receiver) {
		const sender = document.getElementById('nickname').innerText;
		const chatWindow = window.open(`/chat?sender=${encodeURIComponent(sender)}&receiver=${encodeURIComponent(receiver)}`, 'ChatWindow', 'width=800,height=600');
		chatWindow.focus();
	}

	$(document).ready(function () {
		// 사용자 이름 클릭 시 이벤트 처리
		$('.user-name').click(function () {
			const currentUser = $('#nickname').text().trim(); // 현재 사용자 닉네임
			const nickname = $(this).data('nickname');
			if (currentUser !== nickname) {
				const toggleMenu = $(this).siblings('.toggle-menu');
				$('.toggle-menu').not(toggleMenu).hide(); // 다른 모든 토글 메뉴를 숨김
				toggleMenu.toggle(); // 현재 토글 메뉴를 토글
			}
		});

		// "1대1 채팅" 클릭 시 이벤트 처리
		$(document).on('click', '.start-chat', function () {
			const receiver = $(this).data('nickname');
			openChatWithUser(receiver);
		});
	});

	$(document).ready(function () {
		// 태그 선택 시 게시글 필터링
		$('#tagSelect').change(function () {
			const selectedTag = $(this).val();
			loadBoardData(selectedTag);
		});

		// 페이지 로드 시 전체 게시글 로드
		loadBoardData();

		function loadBoardData(tag = '') {
			// 태그에 따라 게시글 데이터를 가져오는 AJAX 요청
			$.ajax({
				url: '/freeboard/paging', // 서버의 API 엔드포인트
				method: 'GET',
				data: {tag: tag},
				success: function (response) {
					// 게시글 데이터를 렌더링
					renderBoardList(response);
				},
				error: function (error) {
					console.error('Error loading board data:', error);
				}
			});
		}

		function renderBoardList(boardData) {
			const boardList = $('#boardList');
			boardList.empty(); // 기존 게시글 목록을 지우고

			// 가져온 게시글 데이터를 반복하며 테이블에 추가
			boardData.forEach(freeboard => {
				const boardRow = `
                <tr>
                    <td>${freeboard.seq}</td>
                    <td>${freeboard.tag}</td>
                    <td><a href="/freeboard/${freeboard.seq}">${freeboard.title}</a></td>
                    <td>${freeboard.nickname}</td>
                    <td>${new Date(freeboard.createdTime).toLocaleDateString()}</td>
                    <td>${freeboard.views}</td>
                    <td>${freeboard.likeCount}</td>
                </tr>
            `;
				boardList.append(boardRow);
			});
		}
	});

</script>

</html>