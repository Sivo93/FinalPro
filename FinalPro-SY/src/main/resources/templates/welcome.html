<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>환영 페이지</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function decodeUrlParam(param) {
            return decodeURIComponent(param.replace(/\+/g, ' '));
        }

        function openChat(receiver) {
            const sender = document.getElementById('nickname').innerText;
            window.location.href = `/chat?sender=${encodeURIComponent(sender)}&receiver=${encodeURIComponent(receiver)}`;
        }

        $(document).ready(function() {
            const urlParams = new URLSearchParams(window.location.search);
            const nickname = decodeUrlParam(urlParams.get('nickname'));
            $('#nickname').text(nickname);

            $('.user-name').click(function() {
                const receiver = $(this).data('nickname');
                openChat(receiver);
            });

            $('#chat-list-link').click(function() {
                const sender = document.getElementById('nickname').innerText;
                window.location.href = `/chat?sender=${encodeURIComponent(sender)}&receiver=`;
            });
        });
    </script>
</head>
<body>
    <h1>환영합니다, <span id="nickname"></span>님!</h1>
    <h2>다른 사용자들:</h2>
    <ul>
        <li th:each="user : ${users}" th:if="${user.nickname} != ${nickname}">
            <span class="user-name" th:data-nickname="${user.nickname}" th:text="${user.nickname}" style="cursor: pointer;"></span>
        </li>
    </ul>
    <div style="margin-top: 20px;">
        <a id="chat-list-link" href="javascript:void(0);">채팅 목록으로 이동</a>
    </div>
</body>
</html>
